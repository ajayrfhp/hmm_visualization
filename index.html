<!doctype html>
<meta charset = 'utf-8'>
<head>
<script type="text/javascript" src = 'bower_components/jquery/dist/jquery.js'></script>

	<script type="text/javascript">
		var data = null;
		var node = null;
		var node0, node1, node2, node3, node4, node5, node6 = null;
		var layers,layer0, layer1, layer2, layer3 = null;
		var answer = new Array();
		var observed_sequence = ['Normal','Cold','Dizzy'];
		$(document).ready(function(){
			data = {
				'states' : ['Healthy','Fever'],
				'observations' : ['Normal','Cold','Dizzy'],
				'start_probability' : {
					'Healthy' : 0.6, 
					'Fever' : 0.4
				},
				'transition_probability' : {
					'Healthy' : {
						'Healthy' : 0.7,
						'Fever' : 0.3
					},
					'Fever' : {
						'Healthy' : 0.4,
						'Fever' : 0.6
					}
				},
				'emission_probability' : {
					'Healthy' : {
						'Normal' : 0.5,
						'Cold' : 0.4,
						'Dizzy' : 0.1
					},
					'Fever' : {
						'Normal' : 0.1,
						'Cold' : 0.3,
						'Dizzy' : 0.6
					}
				}
			};
			// Total number of Nodes = Number of states * Total States
			// Properties of Node : Class
			node = function(id,state,probability) {
				this.id = id;
				this.state = state;
				this.probability = probability || 0; 
			};
			node0 = new node(0,'');
			node1 = new node(1,'Healthy');
			node2 = new node(2,'Fever');
			node3 = new node(3,'Healthy');
			node4 = new node(4,'Fever');
			node5 = new node(5,'Healthy');
			node6 = new node(6,'Fever');
			var layer = function(id,cnt,nodes){
				this.id = id;
				this.cnt = cnt;
				this.nodes = nodes;
			};
			layer0 = new layer(0,1,[node0]);
			layer1 = new layer(0,2,[node1,node2]);
			layer2 = new layer(0,2,[node3,node4]);
			layer3 = new layer(0,2,[node5,node6]);
			layers = [layer0,layer1,layer2,layer3];

			/// FORWARD PROPAGATION
			for( i = 0; i < layers.length; i++ ){
				if( i == 0 ){
					probability = 0;
				}
				else if( i == 1 ){
					for( j = 0; j < layers[i].cnt; j++ ){
						var this_state = layers[i].nodes[j].state;
						layers[i].nodes[j].probability = data.start_probability[this_state] * data.emission_probability[this_state][observed_sequence[i-1]]; 	
					}
				}
				else{
					// DP EQUATION OH WOW OH WOW
					var best_probability = 0;
					
					for( j = 0; j < layers[i].cnt; j++ ){
						best_probability = 0;
						var this_state = layers[i].nodes[j].state;
						for ( k = 0; k < layers[i-1].cnt; k++ ){
							var previous_state = layers[i-1].nodes[k].state;
							var this_probability = data.transition_probability[previous_state][this_state] * layers[i-1].nodes[k].probability * data.emission_probability[this_state][observed_sequence[i-1]];
							if ( best_probability < this_probability ){
								best_probability = this_probability;
							}
						}
						layers[i].nodes[j].probability = best_probability;
					}
					best_probability = 0;
					var best_state = null;
					for ( k = 0; k < layers[i-1].cnt; k++ ){
						if( layers[i-1].nodes[k].probability > best_probability  ){
							best_probability = layers[i-1].nodes[k].probability;
							best_state = layers[i-1].nodes[k].state;
						}
					}
					answer.push(best_state);	
				}
			}

			var best_probability = 0;
			var best_state = null;
			// CHOOSE BEST STATE FOR LAST STAGE ALONE
			for ( k = 0; k < layers[layers.length-1].cnt; k++ ){
					if( layers[layers.length-1].nodes[k].probability > best_probability  ){
						best_probability = layers[layers.length-1].nodes[k].probability;
						best_state = layers[layers.length-1].nodes[k].state;
					}
				}
			answer.push(best_state);
			

		});
	</script>

</head>

<body>
	Goal is to predict the most probable sequence of hidden states given a sequence of observed states. A HMM has been modelled and viterbi algorithm has been used. 
</body>